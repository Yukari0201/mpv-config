###################
# common profiles #
###################



[medium-high]
# 基于 [gpu-hq] 改，中高占用和质量
# 这个 profile 同时承担了选项讲解的作用

## chroma upscaling ；可被效果更好的 KrigBilateral.glsl 代替，见 [KrigBilateral]
cscale = catmull_rom
cscale-antiring = 0.1                   # 可有可无（
#⇧⇧抗振铃(antiring,简称AR) --(c/d/t)scale-antiring= 的值应为 0.0 ~ 1.0 之间的浮点数，且不对 bilinear|bicubic_fast|ewa_xxxx 生效

## image upscaling
scale = ewa_hanning
# scale-antiring = 0.0
linear-upscaling = no                   # [须 --fbo-format 16bit及以上；与 --sigmoid-upscaling 不兼容](对HDR内容无影响) 默认 no
sigmoid-upscaling = yes                 # [与 --linear-upscaling 不兼容] 默认 no

## image downscaling
dscale = catmull_rom                    # 若不设定，则自动采用 --scale 的值
# dscale-antiring = 0.0
linear-downscaling = yes                # [须 --fbo-format 指定16位及以上的精度](对HDR内容无影响)
correct-downscaling = yes               # [当 --dscale=bilinear 时无效] 增强缩小算法的质量

## 其他
scaler-resizes-only                     # [不对 --cscale= 生效] 当未进行缩放处理时，禁用缩放器
                                        # 当 --vo=gpu-next 时，被设计为启用，该选项不执行任何操作
dither-depth = 8                        # <N|no|auto> 是否开启色深抖动弥补色彩转换损失
                                        # auto 可能不正确，此时应该根据自身设备手动指定
dither = fruit                          # 色深抖动的算法
deband = yes                            # 去色带



[medium-low]
# 基于 [gpu-hq] 小改，中低占用和质量
# 4K/UHD -> FHD 时，性能表现不如 [UHD2FHD]
cscale = bilinear
scale = spline36
dscale = catmull_rom                    # 亦可改为 [gpu-hq] 中的 mitchell，ringing更少，但也更糊
dither-depth = 8
dither = fruit
correct-downscaling = yes
linear-downscaling = yes
sigmoid-upscaling = yes
deband = no
scaler-resizes-only



[ASS2margins]
profile-desc = 让ASS字幕可以显示在黑边上
profile-restore = copy
blend-subtitles = no
sub-ass-force-margins = yes             # 强制让ASS字幕可以显示到黑边上，可能破坏显示效果
sub-use-margins = yes                   # (默认即为yes，我只是为了保险才写的) 使纯文本字幕输出在黑边上



[interpolation]
profile-desc = 'default interpolation'
video-sync = display-resample
interpolation                           # [仅当 --video-sync=display-xxxx 时生效] 启用插值
# tscale = mitchell                     # 时间插值算法，示例即默认
                                        # 一般建议 oversample(又叫"smoothmotion")
                                        # 可能有帮助的链接：https://github.com/haasn/interpolation-samples | https://github.com/mpv-player/mpv/issues/2685
# tscale-antiring = 0.0                 # 时域AR(抗振铃)
blend-subtitles = yes                   # <yes|video|no> 在插值和颜色管理之前，将字幕混合到视频帧上
                                        # 当 --vo=gpu-next 时，值 video 不生效
                                        # 与 --interpolation 一起使用时，可提高字幕渲染性能



[blurmotion]
profile = interpolation
tscale = linear



[smoothmotion]
profile = interpolation
tscale = oversample





#################
# auto_profiles #
#################



[UHD2FHD]
# 建议用于于整数倍缩小(如 2160P -> 1080P)，可以仅缩小 luma，不缩小 chorma
# 性能很佳(fastest 0.5x prescaler for mpv)，专治高清病毒，质量也还可以
profile-desc = Fastest profile for UHD -> FHD
profile-cond = p["display-width"]/p["width"] <= 0.5 or p["display-height"]/p["height"] <= 0.5
profile-restore = copy
glsl-shaders-pre = "~~/shaders/acme-0.5x.hook"
# 作者建议和以下配置一同启用
cscale = bilinear                       # FHD 看 UHD 可以让 chorma 实现 --scaler-resizes-only 的效果
scaler-resizes-only                     # [不对 --cscale= 生效]当未进行缩放处理时，禁用缩放器
#window-scale = 0.5                     # 自动缩放窗口至0.5倍大小，与前面的 --window-maximized=yes 冲突
# 为了效率，还可以使用
# hwdec = auto                          # 启用硬解(为了治高清病毒)
deband = no                             # 停用 去色带(为了效率)



[antiring]
# 加载 antiring.hook 着色器（可以和 ewa_xxxx 一同生效）
profile-desc = 'auto load shader "antiring.hook"'
# profile-cond = (p["current-window-scale"]>1.00 or p["fullscreen"]) and p["display-width"]>p["width"] and p["display-height"]>p["height"]
profile-restore = copy
glsl-shaders-append = "~~/shaders/antiring.hook"



[KrigBilateral]
# 当 全屏 且 屏幕和片源分辨率相同时，自动加载 KrigBilateral.glsl
# 我加入 全屏 这个条件是有理由的（我认为全屏之后后才 可 能 享受影片）
profile-desc = 'auto load shader "KrigBilateral.glsl"'
# profile-cond = p["fullscreen"] and (p["display-width"] * p["display-height"] >= p["width"] * p["height"]) and (p["display-width"]==p["width"] or p["dispaly-height"]==p["height"])
profile-restore = copy
glsl-shaders-pre = "~~/shaders/KrigBilateral.glsl"



[VCB-Studio_LoliHouse]
# 遇见 VCB-Studio 和 LoliHouse 的片停用去色带
# 或许不是很有用
profile-desc = 真空断路器
profile-cond = filename:find("VCB%-Studio")~=nil or filename:find("LoliHouse")~=nil
profile-restore = copy
deband = no



[Blibili]
profile-desc = Bilibili
profile-cond = path:find("bilibili.com/")~=nil
profile-restore = copy
ytdl-raw-options-append = cookies-from-browser=firefox
# ytdl-raw-options-append = format-sort=+vcodec:avc



[ontop_back]
# 我不使用置顶，故加注 profile-cond 变其为 common profile
profile-desc = 暂停时取消置顶
# profile-cond = pause
profile-restore = copy
ontop = no



[fps-fix]
# 来自 https://github.com/dyphire/mpv-config/blob/master/mpv.conf
profile-desc = 修复因视频帧率或显示刷新率过高引起的异常耗能或掉帧
profile-cond = p["estimated-vf-fps"] > 47
# profile-cond = p["estimated-vf-fps"] > 47 or p["display-fps"] > 120 # 修复因视频帧率或显示刷新率过高引起的异常耗能或掉帧
profile-restore = copy
video-sync = audio
# 以下一行可选
blend-subtitles = no



[webtorrent_back]
profile-desc = '搭配 webtorrent.js 食用，torrent 边下边播时禁用缓存'
profile-cond = path:find("webtorrent")~=nil
profile-restore = copy
cache = no
